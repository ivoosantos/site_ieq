@page "/Contato"
@using System.Net.Http.Json
@using Newtonsoft;
@using Newtonsoft.Json
@using SiteCRM.FrontEnd.Models
@using System.Text
@inject HttpClient http
@inject NavigationManager NavigationManager;
@inject IJSRuntime JSRuntime
@rendermode InteractiveServer

<PageTitle>Contato</PageTitle>

<img src="image/Banner-contato.jpg" alt="Imagem responsiva" width="100%" height="500px">

<br />
<br />
<br />
<div class="container">
    <div class="row titulo">
        <div class="col-lg-4">
            @* {* <img class="rounded-circle" src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Generic placeholder image" width="140" height="140"> *} *@
            <h3 class="card-title">Culto de Domingo</h3>
            <p>Culto da Família!</p>
            <p class="card-text"><small class="text-muted"></small>Ás 18:30hrs</p>
            @* {* <p><a class="btn btn-secondary" href="#" role="button">View details &raquo;</a></p> *} *@
        </div><!-- /.col-lg-4 --><br />
        <div class="col-lg-4">
            @* {* <img class="rounded-circle" src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Generic placeholder image" width="140" height="140"> *} *@
            <h3 class="card-title">Culto de Quinta-feira</h3>
            <p>Busca pelo Espírito Santo</p>
            <p class="card-text"><small class="text-muted"></small>Ás 19:30hrs</p>
            @* {* <p><a class="btn btn-secondary" href="#" role="button">View details &raquo;</a></p> *} *@
        </div><!-- /.col-lg-4 --><br />
        <div class="col-lg-4">
            @* {* <img class="rounded-circle" src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Generic placeholder image" width="140" height="140"> *} *@
            <h3 class="card-title">Culto de Terça-feira</h3>
            <p>Culto de Oração</p>
            <p class="card-text"><small class="text-muted"></small>Ás 19:30hrs</p>
            @* {* <p><a class="btn btn-secondary" href="#" role="button">View details &raquo;</a></p> *} *@
        </div><!-- /.col-lg-4 --><br />
    </div><!-- /.row -->
</div>
<br />
<br />

<div class="container">
    <h4 class="display-6 text-center">Contato Quadrangular Morro Grande</h4>
    <br />
    <div class="row">
        <div class="col col-md-6">
            <EditForm FormName="informacao" Model="@contato" enctype="multipart/form-data" OnValidSubmit="PostInformacao">
                <div class="form-group col-md-12">
                    <div class="alert alert-info" role="alert">
                        <h5>Informações sobre a Igreja</h5>
                    </div>
                </div>
                <div class="form-group col-md-12">
                    <label for="inputNome4">Nome</label>
                    <InputText type="text" @bind-Value="contato.nome" class="form-control" id="inputNome4" placeholder="Nome"/>
                </div>

                <div class="form-group col-md-12">
                    <label for="inputTelefone4">Telefone</label>
                    <InputText type="phone" @bind-Value="contato.telefone" class="form-control" id="inputTelefone4" placeholder="Telefone"/>
                </div>
                <div class="form-group col-md-12">
                    <label for="inputEmail">E-mail</label>
                    <InputText type="email" @bind-Value="contato.email" class="form-control" id="inputEmail" placeholder="E-mail" />
                </div>

                <div class="form-group col-md-12">
                    <label for="validationTextarea">Mensagem</label>
                    <InputTextArea @bind-Value="contato.mensagem" class="form-control" id="validationTextarea" rows="6"></InputTextArea>

                </div>
                <div class="form-group col-md-12">
                    <button type="submit" class="special btn btn-success">Enviar</button>
                </div>
            </EditForm>
        </div>

        <!--Área do formulário de pedido de oração-->
        <div class="col col-md-6">
            <div class="form-group col-md-12">
                <div class="alert alert-warning" role="alert">
                    <h5>Pedidos de Oração</h5>
                </div>
            </div>
            <EditForm FormName="oracao" Model="@oracao" enctype="multipart/form-data" OnValidSubmit="PostOracao">
                <!--<div class="form-row">
                </div>-->
                <div class="form-group col-md-12">
                    <label for="inputNome4">Nome</label>
                    <InputText type="text" @bind-Value="oracao.nome" class="form-control" id="inputNome4" placeholder="Nome" />
                </div>

                <div class="form-group col-md-12">
                    <label for="inputTelefone4">Telefone</label>
                    <InputText type="phone" @bind-Value="oracao.telefone" class="form-control" id="inputTelefone4" placeholder="Telefone" />
                </div>
                <div class="form-group col-md-12">
                    <label for="inputEmail">E-mail</label>
                    <InputText type="email" @bind-Value="oracao.email" class="form-control" id="inputEmail" placeholder="E-mail" />
                </div>

                <div class="form-group col-md-12">

                    <label for="validationTextarea">Escreva aqui o seu pedido de oração!</label>
                    <InputTextArea class="form-control" @bind-Value="oracao.mensagem" id="validationTextarea" rows="6"></InputTextArea>

                </div>

                <div class="form-group col-md-12">
                    <button type="submit" class="special btn btn-success">Enviar</button>
                </div>
            </EditForm>
        </div>
    </div>
</div>
<hr>

@code {
    private ContactViewModel contato = new ContactViewModel();
    private OracaoViewModel oracao = new OracaoViewModel();

    private async void PostInformacao()
    {
        var url = $"https://localhost:7048/api/contact";

        contato.IsPrayer = false;
        contato.IdIgreja = 1;

        var obj = JsonConvert.SerializeObject(contato);

        var content = new StringContent(obj, Encoding.UTF8, "application/json");
        
        var post2 = await http.PostAsync(url, content);

        if (post2.IsSuccessStatusCode)
        {
            AdicionouNoBanco();
            NavigationManager.NavigateTo("/");
        }
        else
            ErroAoAdicionarNoBanco();
    }

    private async void PostOracao()
    {
        var url = $"https://localhost:7048/api/contact";

        oracao.IsPrayer = true;
        oracao.IdIgreja = 1;

        var obj = JsonConvert.SerializeObject(oracao);
        //https://localhost:7048/api/contact?nome=Mais%20um&telefone=11967675656&email=maisum%40teste.com&mensagem=testando&data=2024-04-09&IsPrayer=true&IdIgreja=1'
        //https://localhost:7048/api/contact?nome=Teste&telefone=11989898989&
        // email=teste%40teste.com&mensagem=Testando&data=2024-04-09&IsPrayer=true&IdIgreja=1
        var content = new StringContent(obj, Encoding.UTF8, "application/json");
        // var post = await http.PostAsJsonAsync<ContactViewModel>(url, contato);
        // var post = await http.PostAsJsonAsync(url, contato);
        var post2 = await http.PostAsync(url, content);

        if (post2.IsSuccessStatusCode)
        {
            AdicionouNoBanco();
            NavigationManager.NavigateTo("/");
        }
        else
            ErroAoAdicionarNoBanco();
    }

    public async void AdicionouNoBanco()
    {
        await JSRuntime.InvokeAsync<string>(
            "SuccessInBD.SuccessInBanco", null
        );
    }

    public async void ErroAoAdicionarNoBanco()
    {
        await JSRuntime.InvokeAsync<string>(
            "ErrorInBanco.ErrorInBanco", null
        );
    }
}


<script>
    (function () {
        window.SuccessInBD = {
            SuccessInBanco: function () {
                return alert('Obrigado pelo contato, em breve entraremos em contato. Deus te abençoe!');
            }
        };
    })();

    (function () {
        window.ErrorInBD = {
            ErrorInBanco: function () {
                return alert('Houve um erro, confere se preencheu tudo ou tente mais tarde. Obrigado!');
            }
        };
    })();
</script>